
; PICBASIC PRO(TM) Compiler 2.50, (c) 1998, 2007 microEngineering Labs, Inc. All Rights Reserved.  
_USED			EQU	1

	INCLUDE	"C:\PBP\16F628A.INC"


; Define statements.
#define		LCD_DREG		 PORTA 
#define		LCD_DBIT		 0 
#define		LCD_RSREG		 PORTB 
#define		LCD_RSBIT		 0 
#define		LCD_EREG		 PORTB 
#define		LCD_EBIT		 1
#define		I2C_SCLOUT		 1 ;para que no necesite resistencia pull-up en SCL

RAM_START       		EQU	00020h
RAM_END         		EQU	0014Fh
RAM_BANKS       		EQU	00003h
BANK0_START     		EQU	00020h
BANK0_END       		EQU	0007Fh
BANK1_START     		EQU	000A0h
BANK1_END       		EQU	000EFh
BANK2_START     		EQU	00120h
BANK2_END       		EQU	0014Fh
EEPROM_START    		EQU	02100h
EEPROM_END      		EQU	0217Fh

R0              		EQU	RAM_START + 000h
R1              		EQU	RAM_START + 002h
R2              		EQU	RAM_START + 004h
R3              		EQU	RAM_START + 006h
R4              		EQU	RAM_START + 008h
R5              		EQU	RAM_START + 00Ah
R6              		EQU	RAM_START + 00Ch
R7              		EQU	RAM_START + 00Eh
R8              		EQU	RAM_START + 010h
FLAGS           		EQU	RAM_START + 012h
GOP             		EQU	RAM_START + 013h
RM1             		EQU	RAM_START + 014h
RM2             		EQU	RAM_START + 015h
RR1             		EQU	RAM_START + 016h
RR2             		EQU	RAM_START + 017h
_anio            		EQU	RAM_START + 018h
_diaF            		EQU	RAM_START + 019h
_diaS            		EQU	RAM_START + 01Ah
_hora            		EQU	RAM_START + 01Bh
_mes             		EQU	RAM_START + 01Ch
_minu            		EQU	RAM_START + 01Dh
PB01            		EQU	RAM_START + 01Eh
_segu            		EQU	RAM_START + 01Fh
_PORTL           		EQU	 PORTB
_PORTH           		EQU	 PORTA
_TRISL           		EQU	 TRISB
_TRISH           		EQU	 TRISA
#define _CPIN            	_PORTB??7
#define _DPIN            	_PORTB??6
#define _actualizado     	 PB01, 000h
#define _PORTB??7        	 PORTB, 007h
#define _PORTB??6        	 PORTB, 006h
	INCLUDE	"RTCCON~1.MAC"
	INCLUDE	"C:\PBP\PBPPIC14.LIB"

	MOVE?CB	007h, CMCON

	LABEL?L	_INICIO	
	I2CDATA?T	_DPIN
	I2CCLOCK?T	_CPIN
	I2CWRITE?C	0D0h
	I2CWRITE?C	000h
	I2CREADS?B	_segu
	I2CDATA?T	_DPIN
	I2CCLOCK?T	_CPIN
	I2CWRITE?C	0D0h
	I2CWRITE?C	001h
	I2CREADS?B	_minu
	I2CDATA?T	_DPIN
	I2CCLOCK?T	_CPIN
	I2CWRITE?C	0D0h
	I2CWRITE?C	002h
	I2CREADS?B	_hora
	I2CDATA?T	_DPIN
	I2CCLOCK?T	_CPIN
	I2CWRITE?C	0D0h
	I2CWRITE?C	003h
	I2CREADS?B	_diaS
	I2CDATA?T	_DPIN
	I2CCLOCK?T	_CPIN
	I2CWRITE?C	0D0h
	I2CWRITE?C	004h
	I2CREADS?B	_diaF
	I2CDATA?T	_DPIN
	I2CCLOCK?T	_CPIN
	I2CWRITE?C	0D0h
	I2CWRITE?C	005h
	I2CREADS?B	_mes
	I2CDATA?T	_DPIN
	I2CCLOCK?T	_CPIN
	I2CWRITE?C	0D0h
	I2CWRITE?C	006h
	I2CREADS?B	_anio
	LCDOUT?C	0FEh
	LCDOUT?C	001h
	LCDOUT?C	0FEh
	LCDOUT?C	002h
	CMPNE?BCL	_diaS, 001h, L00001
	LCDOUT?C	044h
	LCDOUT?C	06Fh
	LCDOUT?C	06Dh
	LCDOUT?C	02Eh
	LABEL?L	L00001	
	CMPNE?BCL	_diaS, 002h, L00003
	LCDOUT?C	04Ch
	LCDOUT?C	075h
	LCDOUT?C	06Eh
	LCDOUT?C	02Eh
	LABEL?L	L00003	
	CMPNE?BCL	_diaS, 003h, L00005
	LCDOUT?C	04Dh
	LCDOUT?C	061h
	LCDOUT?C	072h
	LCDOUT?C	02Eh
	LABEL?L	L00005	
	CMPNE?BCL	_diaS, 004h, L00007
	LCDOUT?C	04Dh
	LCDOUT?C	069h
	LCDOUT?C	065h
	LCDOUT?C	02Eh
	LABEL?L	L00007	
	CMPNE?BCL	_diaS, 005h, L00009
	LCDOUT?C	04Ah
	LCDOUT?C	075h
	LCDOUT?C	065h
	LCDOUT?C	02Eh
	LABEL?L	L00009	
	CMPNE?BCL	_diaS, 006h, L00011
	LCDOUT?C	056h
	LCDOUT?C	069h
	LCDOUT?C	065h
	LCDOUT?C	02Eh
	LABEL?L	L00011	
	CMPNE?BCL	_diaS, 007h, L00013
	LCDOUT?C	053h
	LCDOUT?C	061h
	LCDOUT?C	062h
	LCDOUT?C	02Eh
	LABEL?L	L00013	
	LCDOUTCOUNT?C	002h
	LCDOUTNUM?B	_diaF
	LCDOUTHEX?	
	LCDOUT?C	02Fh
	CMPNE?BCL	_mes, 001h, L00015
	LCDOUT?C	065h
	LCDOUT?C	06Eh
	LCDOUT?C	065h
	LABEL?L	L00015	
	CMPNE?BCL	_mes, 002h, L00017
	LCDOUT?C	066h
	LCDOUT?C	065h
	LCDOUT?C	062h
	LABEL?L	L00017	
	CMPNE?BCL	_mes, 003h, L00019
	LCDOUT?C	06Dh
	LCDOUT?C	061h
	LCDOUT?C	072h
	LABEL?L	L00019	
	CMPNE?BCL	_mes, 004h, L00021
	LCDOUT?C	061h
	LCDOUT?C	062h
	LCDOUT?C	072h
	LABEL?L	L00021	
	CMPNE?BCL	_mes, 005h, L00023
	LCDOUT?C	06Dh
	LCDOUT?C	061h
	LCDOUT?C	079h
	LABEL?L	L00023	
	CMPNE?BCL	_mes, 006h, L00025
	LCDOUT?C	06Ah
	LCDOUT?C	075h
	LCDOUT?C	06Eh
	LABEL?L	L00025	
	CMPNE?BCL	_mes, 007h, L00027
	LCDOUT?C	06Ah
	LCDOUT?C	075h
	LCDOUT?C	06Ch
	LABEL?L	L00027	
	CMPNE?BCL	_mes, 008h, L00029
	LCDOUT?C	061h
	LCDOUT?C	067h
	LCDOUT?C	06Fh
	LABEL?L	L00029	
	CMPNE?BCL	_mes, 009h, L00031
	LCDOUT?C	073h
	LCDOUT?C	065h
	LCDOUT?C	070h
	LABEL?L	L00031	
	CMPNE?BCL	_mes, 010h, L00033
	LCDOUT?C	06Fh
	LCDOUT?C	063h
	LCDOUT?C	074h
	LABEL?L	L00033	
	CMPNE?BCL	_mes, 011h, L00035
	LCDOUT?C	06Eh
	LCDOUT?C	06Fh
	LCDOUT?C	076h
	LABEL?L	L00035	
	CMPNE?BCL	_mes, 012h, L00037
	LCDOUT?C	064h
	LCDOUT?C	069h
	LCDOUT?C	063h
	LABEL?L	L00037	
	LCDOUT?C	02Fh
	LCDOUT?C	032h
	LCDOUT?C	030h
	LCDOUTCOUNT?C	002h
	LCDOUTNUM?B	_anio
	LCDOUTHEX?	
	LCDOUT?C	0FEh
	LCDOUT?C	0C0h
	LCDOUTCOUNT?C	002h
	LCDOUTNUM?B	_hora
	LCDOUTHEX?	
	LCDOUT?C	03Ah
	LCDOUTCOUNT?C	002h
	LCDOUTNUM?B	_minu
	LCDOUTHEX?	
	LCDOUT?C	03Ah
	LCDOUTCOUNT?C	002h
	LCDOUTNUM?B	_segu
	LCDOUTHEX?	
	PAUSE?C	001F4h
	GOTO?L	_INICIO

	LABEL?L	_grabarRTC	
	I2CDATA?T	_DPIN
	I2CCLOCK?T	_CPIN
	I2CWRITE?C	0D0h
	I2CWRITE?C	000h
	I2CWRITES?C	000h
	PAUSE?C	00Ah
	I2CDATA?T	_DPIN
	I2CCLOCK?T	_CPIN
	I2CWRITE?C	0D0h
	I2CWRITE?C	001h
	I2CWRITES?C	032h
	PAUSE?C	00Ah
	I2CDATA?T	_DPIN
	I2CCLOCK?T	_CPIN
	I2CWRITE?C	0D0h
	I2CWRITE?C	002h
	I2CWRITES?C	015h
	PAUSE?C	00Ah
	I2CDATA?T	_DPIN
	I2CCLOCK?T	_CPIN
	I2CWRITE?C	0D0h
	I2CWRITE?C	003h
	I2CWRITES?C	005h
	PAUSE?C	00Ah
	I2CDATA?T	_DPIN
	I2CCLOCK?T	_CPIN
	I2CWRITE?C	0D0h
	I2CWRITE?C	004h
	I2CWRITES?C	021h
	PAUSE?C	00Ah
	I2CDATA?T	_DPIN
	I2CCLOCK?T	_CPIN
	I2CWRITE?C	0D0h
	I2CWRITE?C	005h
	I2CWRITES?C	001h
	PAUSE?C	00Ah
	I2CDATA?T	_DPIN
	I2CCLOCK?T	_CPIN
	I2CWRITE?C	0D0h
	I2CWRITE?C	006h
	I2CWRITES?C	021h
	PAUSE?C	00Ah
	WRITE?CC	000h, 001h
	GOTO?L	_INICIO

	END
